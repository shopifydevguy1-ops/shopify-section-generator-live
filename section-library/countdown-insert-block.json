{
  "id": "countdown-insert-block",
  "name": "CUSTOM Product Countdown",
  "description": "Section: CUSTOM Product Countdown",
  "tags": [
    "countdown"
  ],
  "type": "custom",
  "liquid_code": "<template\n  id=\"countdown-timer-{{ section.id }}\"\n>\n  <style>\n    .countdown-banner-{{ section.id }}-wrapper {\n      padding-top: var(--pt);\n      padding-bottom: var(--pb);\n      margin: var(--mt) 0 var(--mb) 0;\n    }\n    @media screen and (min-width: 750px) {\n      .countdown-banner-{{ section.id }}-wrapper {\n        padding-top: var(--pt-desktop);\n        padding-bottom: var(--pb-desktop);\n      }\n    }\n    .countdown-banner-{{ section.id }} {\n      position: relative;\n      height: var(--section-height-mobile);\n      overflow: hidden;\n    }\n    @media screen and (min-width: 750px) {\n      .countdown-banner-{{ section.id }} {\n        height: var(--section-height);\n      }\n    }\n  </style>\n  <div class=\"countdown-timer-{{ section.id }}\">\n    <div\n      style=\"\n        --pt: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;\n        --pt-desktop: {{ section.settings.padding_top }}px;\n        --pb: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;\n        --pb-desktop: {{ section.settings.padding_bottom }}px;\n        --mt: {{ section.settings.margin_top }}px;\n        --mb: {{ section.settings.margin_bottom }}px;\n        background-color:{{ section.settings.background-color }};\n        background: {{ section.settings.background }};\n        position: relative;\n        border-radius: {{ section.settings.border_radius }}px;\n      \"\n      id=\"countdown-banner-{{ section.id }}-wrapper\"\n      class=\"countdown-banner-{{ section.id }}-wrapper\"\n    >\n      <div\n        class=\"\n          countdown-banner-{{ section.id }}\n          {% unless section.settings.full_width %} page-width {% endunless %}\n        \"\n        style=\"\n          --section-height: {{ section.settings.height }};\n          --section-height-mobile: {{ section.settings.height_mobile }};\n        \"\n      >\n        <div\n          style=\"\"\n        >\n          {% comment %} Content: {% endcomment %}\n          <style>\n            .countdown-banner-content-{{ section.id }} {\n              position: relative;\n              z-index: 1;\n              overflow: hidden;\n              width: 100%;\n              height: 100%;\n              display: flex;\n              flex-direction: column;\n              justify-content: center;\n              align-items: center;\n              gap: 1rem;\n              text-align: center;\n              line-height: 1.1;\n              padding: 16px 5px;\n            }\n\n            @media (min-width: 750px) {\n              .countdown-banner-content-{{ section.id }} {\n                {% comment %} gap:3rem; {% endcomment %}\n              }\n            }\n          </style>\n          <div\n            class=\"countdown-banner-content-{{ section.id }}\"\n          >\n            {% for block in section.blocks %}\n              {% case block.type %}\n                {% when 'text' %}\n                  <style>\n                    .countdown-banner-heading-{{ section.id }}-{{ block.id }} {\n                      font-weight: 700;\n                      font-size: {{ block.settings.font_size | times: 0.85 | round: 0 }}px;\n                      color: {{ block.settings.color }};\n                    }\n                    .countdown-banner-subheading-{{ section.id }}-{{ block.id }} {\n                      font-size: {{ block.settings.subheading_font_size | times: 0.85 | round: 0 }}px;\n                      color: {{ block.settings.subheading_color }};\n                    }\n                    @media (min-width: 750px) {\n                      .countdown-banner-heading-{{ section.id }}-{{ block.id }} {\n                        font-size: {{ block.settings.font_size }}px;\n                      }\n                      .countdown-banner-subheading-{{ section.id }}-{{ block.id }} {\n                        font-size: {{ block.settings.subheading_font_size }}px;\n                      }\n                    }\n                  </style>\n                  <div>\n                    {% if block.settings.heading != blank %}\n                      <div\n                        class=\"countdown-banner-heading-{{ section.id }}-{{ block.id }}\"\n                        style=\"margin-bottom: 0.25rem;\"\n                      >\n                        {{ block.settings.heading }}\n                      </div>\n                    {%- endif -%}\n                    {% if block.settings.subheading != blank %}\n                      <div class=\"countdown-banner-subheading-{{ section.id }}-{{ block.id }}\">\n                        {{ block.settings.subheading }}\n                      </div>\n                    {% endif %}\n                  </div>\n                {% when 'timer' %}\n                  <div\n                    class=\"timer-div-{{ section.id }}\"\n                    style=\"\n                      display: flex;\n                      justify-content: center;\n                      align-items: center;\n                    \"\n                  >\n                    <style>\n                      .timer-div-{{ section.id }} {\n                        gap: 14px;\n                      }\n                      .countdown-timer-{{ section.id }}-{{ block.id }} {\n                        display: flex;\n                        justify-content: center;\n                        gap: 0px;\n                        {% if block.settings.rtl %}\n                          flex-direction: row-reverse;\n                        {% endif %}\n                      }\n                      @media (min-width: 750px) {\n                        .countdown-timer-{{ section.id }}-{{ block.id }} {\n                           gap: 0px;\n                        }\n                        .timer-div-{{ section.id }} {\n                          gap: 14px 28px;\n                        }\n                      }\n                      .countdown-timer-{{ section.id }}-{{ block.id }} .time-block {\n                        position: relative;\n                        border-radius: 12px;\n                        /*padding: 20px;*/\n                        padding: 0 0.5rem;\n                      }\n                      @media (min-width: 750px) {\n                        .countdown-timer-{{ section.id }}-{{ block.id }} .time-block {\n                          padding: 0 0.75rem;\n                        }\n                      }\n                      .countdown-timer-{{ section.id }}-{{ block.id }} .time-block__num,\n                      .countdown-timer-{{ section.id }}-{{ block.id }} .time-block__unit {\n                        display: block;\n                        text-align: center;\n                      }\n                      .countdown-timer-{{ section.id }}-{{ block.id }} .time-block__num {\n                        font-size: {{ block.settings.font_size_number | times: 0.85 | round: 0  }}px;\n                        font-weight: 700;\n                        line-height: 1;\n                      }\n                      .countdown-timer-{{ section.id }}-{{ block.id }} .time-block__unit {\n                        margin-top: 3px;\n                        font-size: {{ block.settings.font_size_text | times: 0.85 | round: 0 }}px;\n                        color: {{ block.settings.color_text }};\n                      }\n                      @media (min-width: 750px) {\n                        .countdown-timer-{{ section.id }}-{{ block.id }} .time-block__unit {\n                          font-size: {{ block.settings.font_size_text }}px;\n                        }\n                        .countdown-timer-{{ section.id }}-{{ block.id }} .time-block__num {\n                          font-size: {{ block.settings.font_size_number }}px;\n                        }\n                        .countdown-timer-{{ section.id }}-{{ block.id }} .time-colon {\n                          font-weight: 700;\n                          font-size: {{ block.settings.font_size_number }}px;\n                        }\n                      }\n                      .countdown-timer-{{ section.id }}-{{ block.id }} .time-divier {\n                        position: relative;\n                        width: 2px;\n                        height: 40px;\n                        background-color: var(--color);\n                      }\n                      .countdown-timer-{{ section.id }}-{{ block.id }} .time-colon {\n                        font-weight: 700;\n                        font-size: {{ block.settings.font_size_number | times: 0.85 | round: 0}}px;\n                      }\n                    </style>\n\n                    <div\n                      class=\"countdown-timer-{{ section.id }}-{{ block.id }}\"\n                      {{ block.shopify_attributes }}\n                      style=\"\n                        color: {{ block.settings.color }};\n                        --color: {{ block.settings.color }};\n                      \"\n                      data-date-string=\"{{ block.settings.year }}-{{ block.settings.month }}-{{ block.settings.day }}T{{ block.settings.hour }}:{{ block.settings.minute }}:00Z\"\n                      data-hour-left=\"{{ block.settings.x_hours_left }}\"\n                      data-ss-countdown-timer-wrapper\n                    >\n                      <div class=\"time-block\">\n                        <span class=\"time-block__num js-timer-days\">00</span>\n                        <span class=\"time-block__unit\">{{ block.settings.day_text }}</span>\n                      </div>\n                      <span class=\"time-colon\">:</span>\n                      <div class=\"time-block\">\n                        <span class=\"time-block__num js-timer-hours\">00</span>\n                        <span class=\"time-block__unit\">{{ block.settings.hour_text }}</span>\n                      </div>\n                      <span class=\"time-colon\">:</span>\n                      <div class=\"time-block\">\n                        <span class=\"time-block__num js-timer-minutes\">00</span>\n                        <span class=\"time-block__unit\">{{ block.settings.minute_text }}</span>\n                      </div>\n                      <span class=\"time-colon\">:</span>\n                      <div class=\"time-block\">\n                        <span class=\"time-block__num js-timer-seconds\">00</span>\n                        <span class=\"time-block__unit\">{{ block.settings.second_text }}</span>\n                      </div>\n                    </div>\n\n                    <style>\n                      .countdown-banner-button-{{ section.id }}-{{ block.id }} {\n                        padding: 16px 12px;\n                        text-decoration: none;\n                      }\n                      @media (min-width: 750px) {\n                        .countdown-banner-button-{{ section.id }}-{{ block.id }} {\n                          padding: 16px 25px;\n                        }\n                      }\n                    </style>\n                    {% for button_block in section.blocks %}\n                      {% if button_block.type == 'button' and button_block.settings.button_text != blank %}\n                        {%- if button_block.settings.button_on_next_line -%}\n                          <style>\n                            .timer-div-{{ section.id }} {\n                              flex-direction: column;\n                            }\n                          </style>\n                        {%- endif -%}\n                        <a\n                          href=\"{{ button_block.settings.button_link }}\"\n                          class=\"countdown-banner-button-{{ section.id }}-{{ block.id }}\"\n                          style=\"\n                            white-space: nowrap;\n                            color: {{ button_block.settings.button_color }};\n                            background-color: {{ button_block.settings.background_color }};\n                            border-radius: {{ button_block.settings.border_radius }}px;\n                            font-size: {{ button_block.settings.font_size }}px;\n                            font-weight:700;\n                            border: {{button_block.settings.button_border_thickness}}px {{button_block.settings.button_border_color}} solid;\n                          \"\n                        >\n                          {{ button_block.settings.button_text }}\n                        </a>\n                      {% endif %}\n                    {% endfor %}\n                  </div>\n                {% else %}\n\n              {% endcase %}\n            {% endfor %}\n          </div>\n        </div>\n      </div>\n\n      {% comment %} Close button: {% endcomment %}\n      <style>\n        @media (min-width: 750px) {\n          #close-button-{{ section.id }} {\n            padding: 0 10px 0 0;\n          }\n        }\n      </style>\n      <div\n        style=\"\n          position: absolute;\n          top: 50%;\n          right: 0;\n          transform: translateY(-50%);\n          padding: 0 5px 0 0;\n          color: gray;\n          cursor: pointer;\n          display: none;\n        \"\n        id=\"close-button-{{ section.id }}\"\n      >\n        <svg\n          stroke=\"currentColor\"\n          fill=\"currentColor\"\n          stroke-width=\"0\"\n          viewBox=\"0 0 512 512\"\n          height=\"1em\"\n          width=\"1em\"\n          xmlns=\"http://www.w3.org/2000/svg\"\n        >\n          <path d=\"M405 136.798L375.202 107 256 226.202 136.798 107 107 136.798 226.202 256 107 375.202 136.798 405 256 285.798 375.202 405 405 375.202 285.798 256z\"></path>\n        </svg>\n      </div>\n      <script>\n        document.getElementById('close-button-{{ section.id }}').addEventListener('click', function () {\n          document.getElementById('countdown-banner-{{ section.id }}-wrapper').style.display = 'none';\n        });\n      </script>\n    </div>\n  </div>\n</template>\n\n{% comment %} <div id=\"countdown-default-target-{{ section.id }}\"></div> {% endcomment %}\n\n<script>\n (function () {\n  let clearSSCountdownTimer = null;\n\n  function setCountdownToLocalStorage(date) {\n    localStorage.setItem('ss-countdown-timer-hour-left', date);\n  }\n\n  function getCountdownToLocalStorage() {\n    return localStorage.getItem('ss-countdown-timer-hour-left');\n  }\n\n  function clearCountdownToLocalStorage() {\n    localStorage.removeItem('ss-countdown-timer-hour-left');\n  }\n\n  function startTimer() {\n    const second = 1000,\n      minute = second * 60,\n      hour = minute * 60,\n      day = hour * 24,\n      wrapper = document.querySelector('.countdown-timer-{{ section.id }} [data-ss-countdown-timer-wrapper]');\n    \n    if (!wrapper) return;\n\n    const dateString = wrapper.dataset.dateString;\n    const [yearStr, monthStr, dayTimeStr] = dateString.split('-');\n    const [dayStr, timeStr] = dayTimeStr.split('T');\n    const [hourStr, minuteStr] = timeStr.split(':');\n\n    let countDown;\n    const hourLeft = parseInt(wrapper.dataset.hourLeft);\n\n    if (hourLeft > 0) {\n      countDown = Date.now() + hourLeft * 60 * 60 * 1000;\n      let countDownFromLocalStorage = getCountdownToLocalStorage();\n      if (!countDownFromLocalStorage) {\n        setCountdownToLocalStorage(countDown);\n      } else {\n        countDown = parseInt(countDownFromLocalStorage);\n      }\n    } else {\n      // Создаем дату в UTC\n      const targetDate = new Date(Date.UTC(\n        parseInt(yearStr, 10),\n        parseInt(monthStr, 10) - 1,\n        parseInt(dayStr, 10),\n        parseInt(hourStr, 10),\n        parseInt(minuteStr, 10),\n        0\n      ));\n      countDown = targetDate.getTime();\n    }\n\n    console.log('Product timer end date:', new Date(countDown).toISOString());\n\n    const interval = setInterval(function () {\n      let now = Date.now(),\n        distance = countDown - now,\n        days = Math.floor(distance / day),\n        hours = Math.floor((distance % day) / hour),\n        minutes = Math.floor((distance % hour) / minute),\n        seconds = Math.floor((distance % minute) / second);\n\n      if (wrapper.querySelector('.js-timer-days')) {\n        wrapper.querySelector('.js-timer-days').innerText = (days < 10 ? '0' : '') + days;\n      }\n      if (wrapper.querySelector('.js-timer-hours')) {\n        wrapper.querySelector('.js-timer-hours').innerText = ('0' + hours).slice(-2);\n      }\n      if (wrapper.querySelector('.js-timer-minutes')) {\n        wrapper.querySelector('.js-timer-minutes').innerText = ('0' + minutes).slice(-2);\n      }\n      if (wrapper.querySelector('.js-timer-seconds')) {\n        wrapper.querySelector('.js-timer-seconds').innerText = ('0' + seconds).slice(-2);\n      }\n\n      if (distance < 0) {\n        if (wrapper.querySelector('.js-timer-days')) {\n          wrapper.querySelector('.js-timer-days').innerText = '00';\n        }\n        if (wrapper.querySelector('.js-timer-hours')) {\n          wrapper.querySelector('.js-timer-hours').innerText = '00';\n        }\n        if (wrapper.querySelector('.js-timer-minutes')) {\n          wrapper.querySelector('.js-timer-minutes').innerText = '00';\n        }\n        if (wrapper.querySelector('.js-timer-seconds')) {\n          wrapper.querySelector('.js-timer-seconds').innerText = '00';\n        }\n\n        clearInterval(interval);\n\n        {%- for block in section.blocks -%}\n          {% if block.settings.hide_widget_on_completed %}\n            const timer = document.querySelector('.countdown-timer-{{ section.id }}');\n            if (hourLeft > 0) {\n              if (timer) {\n                timer.style.display = 'none';\n              }\n            }\n          {% endif %}\n        {%- endfor -%}\n      }\n    }, second);\n\n    clearSSCountdownTimer = function () {\n      clearInterval(interval);\n    };\n  }\n\n  function init() {\n    const selectorEl = document.querySelector('{% if section.settings.countdown_position == \"below_title\" or section.settings.countdown_position == \"above_title\" %}.product__title{% elsif section.settings.countdown_position == \"below_description\" %}.product__description{% else %}.button--add-to-cart, .product .product-form, .product-single__add-to-cart, .shopify-payment-button, .shopify-payment-button__button, .ProductForm__BuyButtons, .add-to-cart{% endif %}');\n    const targetEl = document.querySelector('#custom-countdown-insert-block');\n    const target = targetEl ? targetEl : selectorEl;\n    \n    if (target) {\n      const template = document.querySelector('#countdown-timer-{{ section.id }}');\n      const clone = document.importNode(template.content, true);\n      clone\n        .querySelector('.countdown-timer-{{ section.id }}')\n        .classList.add('countdown-timer-{{ section.id }}--inited');\n      \n      {% if section.settings.countdown_position == \"below_buy\" or section.settings.countdown_position == \"below_title\" or section.settings.countdown_position == \"below_description\" %}\n        target.insertBefore(clone, target.firstChild);\n      {% else %}\n        target.appendChild(clone);\n      {% endif %}\n\n      startTimer();\n    }\n  }\n\n  document.addEventListener('DOMContentLoaded', init);\n  if (window.Shopify && Shopify.designMode) {\n    document.addEventListener('shopify:section:load', (event) => {\n      if (event.detail.sectionId === '{{ section.id }}') init();\n    });\n    document.addEventListener('shopify:section:unload', (event) => {\n      if (event.detail.sectionId === '{{ section.id }}') {\n        const initedEl = document.querySelector('.countdown-timer-{{ section.id }}--inited');\n        if (initedEl) initedEl.remove();\n        if (clearSSCountdownTimer) clearSSCountdownTimer();\n        clearCountdownToLocalStorage();\n      }\n    });\n  }\n})();\n</script>",
  "variables": {
    "countdown_position": {
      "type": "text",
      "default": "below_buy",
      "label": "Countdown Position",
      "description": "Countdown Position"
    },
    "background": {
      "type": "color",
      "default": "",
      "label": "Background Gradient",
      "description": "Background Gradient"
    },
    "background-color": {
      "type": "color",
      "default": "#000000",
      "label": "Section background color",
      "description": "Section background color"
    },
    "padding_top": {
      "type": "text",
      "default": "0",
      "label": "Padding top",
      "description": "Padding top"
    },
    "padding_bottom": {
      "type": "text",
      "default": "0",
      "label": "Padding bottom",
      "description": "Padding bottom"
    },
    "margin_top": {
      "type": "text",
      "default": "0",
      "label": "Margin top",
      "description": "Margin top"
    },
    "margin_bottom": {
      "type": "text",
      "default": "0",
      "label": "Margin bottom",
      "description": "Margin bottom"
    },
    "border_radius": {
      "type": "text",
      "default": "0",
      "label": "Border radius",
      "description": "Border radius"
    }
  }
}