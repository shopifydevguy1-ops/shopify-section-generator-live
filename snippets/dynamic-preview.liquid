{% comment %}
  Dynamic Preview Snippet
  Location: /snippets/dynamic-preview.liquid
  Purpose: Renders dynamically generated Liquid code in a safe preview container
  
  Usage:
  {% render 'dynamic-preview', section_code: generated_code, section_schema: generated_schema %}
{% endcomment %}

{%- liquid
  assign preview_code = section_code | default: ''
  assign preview_schema = section_schema | default: '{}'
-%}

<div class="dynamic-preview-wrapper" data-preview-mode="true">
  {% if preview_code != blank %}
    {% comment %}
      Note: Shopify doesn't allow dynamic Liquid rendering from strings.
      This is a fallback that displays the code structure and uses JavaScript
      to create a mock preview based on schema defaults.
    {% endcomment %}
    
    <div class="preview-code-structure">
      <div class="preview-notice">
        <strong>Preview Mode:</strong> This is a simulated preview. The actual section will render correctly when added to your theme.
      </div>
      
      {% comment %} Try to extract and display key information from the code {% endcomment %}
      <div class="preview-mock-container" id="preview-mock-{{ section.id | default: 'default' }}">
        {% comment %} JavaScript will populate this with a mock preview {% endcomment %}
        <div class="mock-loading">Generating preview...</div>
      </div>
    </div>
    
    {% comment %} Store code and schema in data attributes for JavaScript processing {% endcomment %}
    <script type="application/json" id="preview-data-{{ section.id | default: 'default' }}">
      {
        "code": {{ preview_code | json }},
        "schema": {{ preview_schema | json }}
      }
    </script>
    
  {% else %}
    <div class="preview-empty">
      <p>No preview available. Please generate a section first.</p>
    </div>
  {% endif %}
</div>

<style>
  .dynamic-preview-wrapper {
    width: 100%;
    min-height: 200px;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    background: #fff;
    padding: 20px;
  }
  
  .preview-notice {
    background: #fef3c7;
    border: 1px solid #fbbf24;
    padding: 12px;
    border-radius: 6px;
    margin-bottom: 20px;
    font-size: 14px;
    color: #92400e;
  }
  
  .preview-mock-container {
    min-height: 150px;
  }
  
  .mock-loading {
    text-align: center;
    padding: 40px;
    color: #6b7280;
  }
  
  .preview-empty {
    text-align: center;
    padding: 60px 20px;
    color: #9ca3af;
  }
</style>

