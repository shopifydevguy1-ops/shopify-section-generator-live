<style>
  .announcement-bar,
  .announcement-bar__message {
    overflow: hidden;
  }
  .ss-announcement-bar__link {
    display: block;
    width: 100%;
    padding: 1.5rem 2rem;
    text-decoration: none;
    cursor: pointer;
    color: var(--text-color);
    line-height:0;
  }
  .ss-announcement-bar__link:hover {
    color: var(--text-color);
  }
  #marq {
    width: 100%;
    border: inset;
    overflow: hidden;
    white-space: nowrap;
    box-shadow: unset;
    border: 0;
    max-height: calc(35px + {{section.settings.text_size}}px);
    box-shadow: unset;
    border-color: currentcolor;
    vertical-align: middle;
  }
  {% if section.settings.animation_direction == "left" %}
  @keyframes marquesina {
    0% {
      transform: translate(0);
    }
    to {
      transform: translate(-50%);
    }
  }
  @keyframes marquesina-reverse {
    0% {
      transform: translate(50%);
    }
    to {
      transform: translate(0);
    }
  }
  {% else %}
    @keyframes marquesina {
      0% {
        transform: translate(-50%);
      }
      to {
        transform: translate(0);
      }
    }
    @keyframes marquesina-reverse {
        0% {
          transform: translate(0);
        }
        to {
          transform: translate(50%);
        }
      }
  {% endif %}
  #orig {
    display: inline-block;
    overflow: hidden;
    transform: translate(0);
    animation: marquesina var(--animation-duration, 45s) infinite normal linear
      2s;
  }
  #orig.reverse {
    animation: marquesina-reverse var(--animation-duration, 45s) infinite normal linear
      2s !important;
  }
  .announcement-bar__message {
    text-align: center;
    /* padding: 5px 0 0 !important; */
    padding: 5px 0 0;
    margin: 0;
    /* letter-spacing: unset; */
    line-height: calc({{section.settings.text_size}}px + 2px);
    font-size: {{section.settings.text_size}}px;
  }
  #orig.reverse .announcement-bar__message {
    display: flex;
    flex-direction: row-reverse;
  }
  .announcement-bar__message li {
    display: inline-block;
    padding-right: 114px;
    position: relative;
  }
  .announcement-bar__message li::after {
    content: '';
    width: 3.5px;
    height: 3.5px;
    background-color: var(--text-color);
    background-image: none;
    opacity: 0.3;
    border-radius: 50%;
    position: absolute;
    top: 40%;
    right: 50px;
  }
  @media (max-width: 480px) {
    #marq {
      max-height: 39px;
    }
    .announcement-bar__message li {
      padding-right: 55px;
    }
    .announcement-bar__message li::after {
      right: 25px;
    }
  }
</style>

{% if section.settings.pause_hover %}
  <style>
    .announcement-bar:hover #orig {
      animation-play-state: paused !important;
    }
  </style>
{% endif %}

<template id="marquee-announcement-bar-{{ section.id }}">
  <div
    class="announcement-bar"
    aria-label="Announcement"
    style="background-color: {{ section.settings.bg }}; --text-color: {{ section.settings.text_color }}; --animation-duration: {{ section.settings.animation_duration }}s;"
  >
    <a
      href="{{ section.settings.link }}"
      class="ss-announcement-bar__link"
    >
      <div id="marq">
        <span id="orig">
          <ul class="announcement-bar__message">
            {% for i in (1..6) %}
              {% for block in section.blocks %}
                <li>{{ block.settings.text }}</li>
              {% endfor %}
            {% endfor %}

            {% for block in section.blocks limit: 1 %}
              <!-- <li>{{ block.settings.text }}</li> -->
            {% endfor %}
          </ul>
        </span>
      </div>
    </a>
  </div>
</template>

<div id="marquee-local-target"></div>

<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    let cssTarget = '{{ section.settings.insert_css_class_target }}';
    let productForm = cssTarget
      ? document.querySelector(cssTarget)
      : document.querySelector('#marquee-local-target');

    if (!productForm) return;

    const templateContent = document.querySelector(
      '#marquee-announcement-bar-{{ section.id }}'
    ).content;

    productForm.insertAdjacentElement(
      'beforebegin',
      templateContent.firstElementChild
    );

    setTimeout(()=> {
      var htmlElement = document.documentElement;

      if (window.getComputedStyle(htmlElement).getPropertyValue('direction') === 'rtl') {
          document.querySelector('#orig').classList.add('reverse');
      }
    }, 1000);
  });
</script>

{% schema %}
{
  "name": "Marquee Announcement Bar",
  "settings": [
    {
      "type": "text",
      "id": "insert_css_class_target",
      "label": "Target CSS Class",
      "default": ".header, .pageheader",
      "placeholder": ".header, .pageheader",
      "info": "If empty, the announcement bar will display normally. If you want to display the announcement bar in a specific place, you can add the CSS class of the target element here. Default is above header as announcement bar"
    },
    {
      "type": "header",
      "content": "Text"
    },
    {
        "type": "range",
        "id": "text_size",
        "label": "Font size",
        "default": 12,
        "min": 8,
        "max": 30,
        "step": 1,
        "unit": "px"
    },
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "link",
      "label": "Link",
      "default": "#"
    },
    {
      "type": "header",
      "content": "Animation"
    },
    {
      "type": "range",
      "id": "animation_duration",
      "label": "Animation Duration",
      "unit": "sec",
      "min": 10,
      "max": 110,
      "step": 1,
      "default": 45
    },
    {
      "type": "select",
      "id": "animation_direction",
      "label": "Animation Direction",
      "default": "left",
      "options": [
        {
          "label": "Left",
          "value": "left"
        },
        {
          "label": "Right",
          "value": "right"
        }
      ]
    },
    {
      "type": "checkbox",
      "id": "pause_hover",
      "label": "Pause on Hover",
      "default": true
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "bg",
      "label": "Background Color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#fff"
    }
  ],
  "presets": [
    {
      "category": "Custom",
      "name": "Marquee Announcement Bar",
      "blocks": [
        {
          "type": "text"
        },
        {
          "type": "text"
        }
      ]
    }
  ],
  "max_blocks": 4,
  "blocks": [
    {
      "type": "text",
      "name": "Text",
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "Text",
          "default": "SAVE X %"
        }
      ]
    }
  ]
}
{% endschema %}
